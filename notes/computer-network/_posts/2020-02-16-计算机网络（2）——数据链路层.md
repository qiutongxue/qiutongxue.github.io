---
layout: post
author: Berry Qiu
title: 
subtitle: 
cover: 
color: '' # 默认根据字数生成相应颜色
tags: 
    - 计算机网络
    - 学习笔记
# permalink: /note
---

# 数据链路层

## 数据链路层的基本概念及基本问题

### 数据链路层的信道类型

- 点对点信道：一对一，点对点通信
- 广播信道：一对多，过程较复杂。广播信道上连接的主机比较多，因此必须使用专用的共享信道协议来协调主机的数据发送。

### 链路与数据链路

- 链路（link）：是一条点到点的物理线路段，中间没有任何其他的交换结点。
  - 一条链路只是一条通路的一个组成部分
- 数据链路（data link）：除了物理线路外，还必须有通信协议来控制这些数据的传输，若把实现这些协议的硬件和软件加到链路上，就构成了数据链路。 
  - 现最常用的方法是使用适配器（网卡）来实现这些协议的硬件和软件。
  - 一般的适配器都包括了数据链路层和物理层的功能。
  
### 帧

数据链路层传送的是**帧**。

网络层信息+帧头+帧尾+物理层地址+校验值 构成一个完整的帧。

### 数据链路层的三个基本问题

#### 1.封装成帧

- 封装成帧(framing)就是在一段数据的前后分别添加首部和尾部，然后就构成了一个帧，确定帧的界限。
- 首部和尾部的一个重要作用就是进行帧定界。

#### 2.透明传输

- 帧开始符SOH，帧结束符EOT
- 若在原始数据中出现了EOT，前半段在接收端会被误认为是一个帧，后半段会被当做无效帧。
- 故用字节填充法解决透明传输的问题：在数据中出现的SOH/EOT前面加上转义字符`ESC`，原始数据中有ESC，则在ESC前再加一个ESC。
- 发送端加转义字符，接收端去除转义字符，这就是透明传输。

#### 3.差错控制

- 传输过程中可能会产生比特差错，1可能变成0,0可能变成1。
- 误码率BER(Bit Error Rate)=传输错误的比特/传输比特总数
- 误码率和信噪比有很大的关系

**循环冗余算法CRC，算出FCS(Frame Check Sequence，帧检验序列).**

接收端对收到的每一帧进行CRC检验

若得出的余数R=0，则判定这个帧没有差错，就接受（accept），若余数不等于0，就丢弃。

特点：

- 这种检测方法并不能确定究竟是哪一个或者哪几个比特出现了差错
- 只要经过严格的挑选，并使用位数足够多的除数P，那么出现检测不到的差错的概率就很小很小

## 两种情况下的数据链路层

### 使用点对点信道的数据链路层

#### PPP协议（点对点协议）

- 现在全世界使用得最多的数据链路层协议是点对点协议PPP（Point-to-Point Protocol） 

- PPP协议应该满足的要求
  - 简单——首要要求
  - 封装成帧
  - 透明性
  - 差错检测
  - 多种网络层协议
  - 多种类型链路
  - 检测连接状态
  - 最大传送单元
  - 网络层地址协商
  - 数据压缩协商
  
PPP协议有三个组成部分:

- 数据链路层协议可以用于异步串行或同步串行介质。
- 使用LCP（链路控制协议）建立并维护数据链路连接
- 网络控制协议（NCP）允许在点到点连接上使用多种网络协议

### 使用广播信道的数据链路层(局域网)

- 集线器、 总线等

#### CSMA/CD协议

Carrier Sense Multiple Access with Collision Detection，载波监听多点接入/碰撞检测

- “**多点接入**”：表示许多计算机以多点接入的方式连接在一根总线上。
- “**载波监听**”：指每一个站在发送数据之前先要检测一下总线上是否有其他计算机在发送数据，如果有，暂时不要发送数据，以免发生碰撞。“载波监听”就是用电子技术检测总线上有没有其他计算机发送的数据信号。
- “**碰撞检测**”：就是计算机边发送数据边检测信道上的信号电压大小。
  - 当几个站同时在总线上发送数据时，总线上的信号电压摆动值将会增大（互相叠加）
  - 当一个站检测到的信号电压摆动值超过一定的门限值时，就认为总线上至少有两个站同时在发送数据，表明产生了**碰撞**。
  - “碰撞”就是发生了冲突，因此“碰撞检测”也称为“**冲突检测**”。

##### 重要特性

- 使用CSMA/CD协议的以太网**不能进行全双工通信**而只能进行双向交替通信（半双工通信）
- 每个站在发送数据之后的一小段时间内，存在遭遇碰撞的可能性
- 这种发送的不确定性使整个以太网的平均通信量**远小于**以太网的最高数据率

##### 争用期

以太网的端到端往返时延2τ称为争用期，或碰撞窗口，通常取51.2微妙为争用期的长度。  
比如10Mb/s以太网，在争用期内可发送64字节，若前64字节未发生冲突，后续数据就不会发生冲突。

因此，以太网规定了最短有效帧长为64字节。**小于64字节的帧都是由于冲突而异常终止的无效帧。**

##### 二进制指数类型退避算法

发生碰撞的站在停止发送数据后，要推迟（退避）一个随机时间才能再发送数据。

- 确定**基本退避时间**，一般取争用期2τ
- 定义参数 `$k=min\{重传次数,10\}$`
- 从整数集合`$0,1,..,2^k-1$`中随机取出一个数，记为r，重传所需的时延就是`$r\times 2τ $`的**基本退避时间**
- 重传16次仍未成功，丢弃该帧，并向上层报告。

## 以太局域网（以太网）

- 满足CSMA/CD的都可以称为以太网
- 无差错接受，没有纠错功能（纠错交给传输层）
- 10BASE-T
- 星型拓扑

### 以太网的信道利用率

在以太网中定义参数a，它是以太网单程端到端时延τ与帧的发送时间T0之比

$$
a = \frac τ {T_0}
$$

- `$a\rarr 0 $`表示一发生碰撞就立即可以检测出来，并立即停止发送，因而信道利用率很高
- a越大，表明争用期所占的比例增大，每发生一次碰撞就浪费许多信道资源，使得信道占用率明显降低。

**理想情况下**的极限信道利用率

$$
S_{max} = \cfrac {T_0} {T_0 + τ } = \cfrac 1 {1+a}
$$

### MAC层

在局域网中，**硬件地址**又称为**物理地址**，或**MAC地址**

MAC地址前24位表示厂家，后24位是厂家自定的，保证全球唯一

改MAC地址方法：

1. 打开网络和Internet设置
2. 更改适配器选项
3. 右键以太网-属性-配置-高级
4. 找到网络地址，输入值

#### MAC帧格式

目的地址(6)+源地址(6)+类型(2)+数据(46~1500)+FCS(4)

> 在物理层传输时还要在前面插入8字节（前同步码(7)+帧开始定界符(1)）

> 抓包工具 wireshark

## 扩展以太网

在物理层考虑，可以采用集线器级联的方式，使网络中计算机数量增加，但是效率降低了（小的冲突域变成大的冲突域）

### 在数据链路层考虑扩展

在数据链路层扩展局域网使用**网桥**

网桥就是**交换机**的前身

交换机：全双工通信、安全、不冲突、端口带宽独享、基于MAC地址

## 高速以太网

- 速率达到或超过100Mb/s的以太网称为**高速以太网**
- 在双绞线上传送100Mb/s基带信号的星型拓扑以太网，仍使用IEEE 802.3的CSMA/CD协议。100BASE-T以太网又称为**快速以太网**

### 吉比特以太网

允许在1Gb/s下全双工和半双工两种方式工作
