---
layout: post
author: Berry Qiu
title: 
subtitle: 
cover: 
color: '' # 默认根据字数生成相应颜色
tags: 
    - 计算机网络
    - 学习笔记

tips: [密钥, 数字签名, SSL, IPsec, PGP]
---

# 网络安全

## 网络安全问题概述

### 被动攻击与主动攻击

被动攻击： 截获。攻击者在网络上窃听他人的通信内容。

主动攻击：

1. 篡改：攻击者故意篡改网络上传送的报文，也包括中断传送的报文，甚至伪造报文。
2. 恶意程序：
   - 计算机病毒 computer virus：一种会传染其它程序的程序（通过修改其它程序来把自身或变种复制进去）。
   - 计算机蠕虫 computer worm：通过网络的通信功能将自身从一个结点发送到另一个结点并自动启动运行的程序。主要消耗系统资源。
   - 特洛伊木马 Trojan horse：执行的功能并非所声称的功能而是某种恶意的功能的程序。
   - 逻辑炸弹 logic bomb：运行环境满足某种特定条件时执行其他特殊功能的程序。
3. 拒绝服务 Dos（Denial of Service）：攻击者向因特网上的某个服务器不停地发送大量分组，使因特网或服务器无法提供正常的服务。DDos(Distributed Denial of Service) 分布式拒绝服务，从因特网上成百上千的网站集中攻击一个网站。

### 计算机网络安全的内容

1. 保密性
2. 安全协议的设计
3. 访问控制

## 两类密码体制

### 对称密钥密码体制

**对称密钥密码体制，即加密密钥与解密密钥是相同的密码体制。**

**数据加密标准 DES**（Data Encryption Standard） 属于对称密钥密码体制。

**DES的保密性仅取决于对密钥的保密，算法是公开的。**

**国际数据加密算法 IDEA（International Data Encryption Algorithm）**，使用128位密钥，更不容易被攻破。

优点：效率高

缺点：密钥不适合在网上传输（容易被截获）、密钥维护不方便

### 公钥密码体制（非对称加密）

公钥加密、私钥解密。

产生原因：公钥密码体制的产生主要是因为两个方面的原因，一是由于对称密钥密码体制的**密钥分配**问题，二是由于对**数字签名**的需求。

## 数字签名

数字签名必须实现的功能：

1. **报文鉴别**。接受者能够核实发送者对报文的签名。
2. **报文的完整性**。接受者确信收到的数据和发送者发送的完全一样没有被篡改过。
3. **不可否认**。发送者事后不能抵赖对报文的签名。

![数字签名](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200228210531.png)

## 鉴别

**鉴别是要验证通信的对方的确是自己所要通信的对象，而不是其他冒充者。**

### 报文鉴别

当传送的报文不需要加密但是又要数字签名时，显然如果对整个报文数字签名会增加很多负担。此时，就需要**报文摘要 MD（Message Digest）**。

对报文摘要进行数字签名得出的已签名的报文摘要称为**报文鉴别码 MAC（Message Authentication Code）**。

A 先对文件内容进行单项散列，得到128位固定长度的摘要，再用私钥 $SK_A$ 进行加密，得到MAC。B 获得文件内容后，同样对文件单项散列计算128位摘要，再用公钥 $PK_A$ 对 MAC 解密，看看能否得到同样地摘要。

报文和报文鉴别码 MAC 合在一起，是不可伪造的，是**可检验的**和**不可否认的**。

MD5算法：

1. 把任意长的报文按模 $2^{64}$ 计算其余数（64 位），追加在报文后面。
2. 在报文和余数之间填充 1~512 位，使得填充的总长度是 512 的整数倍。填充的首位为 1，后面都是 0。
3. 把追加和填充后的报文分割为一个个 512 位的数据块，每个 512 位的报文数据再分成 4 个 128 位的数据块一次送到不同的散列函数进行 4 轮计算。每一轮又都按 32 位的小数据块进行复杂的计算。直到最后计算出 MD5 报文摘要代码。

安全散列算法 SHA（Secure Hash Algorithm）与 MD5 相似，但是码长达到 160 位，更安全，但计算上比 MD5 慢。

## 密钥分配

### 对称密钥的分配

常用的对称密钥分配方式是设立**密钥分配中心 KDC（Key Distribution Center）**。

![对称密钥的分配](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200228222053.jpg)

### 公钥的分配

**认证中心 CA（Certification Authority）**，负责公钥分配。

CA 的公钥用来验证某个公钥是否为某个实体所拥有（通过向 CA 查询）。

比如，A 向 CA 申请一对密钥 $ SK_A, PK_A$，这对密钥被 CA 的公钥加密了，B 收到 A 发来的报文，首先用 CA 的公钥判断 $PK_A$ 是否是 A 公司的公钥，如果是，再用 $PK_A$ 解密 A 报文的数字证书。

## Internet 使用的安全协议

### 传输层：SSL/TLS

SSL：安全套接字层（Secure Socket Layer）

TLS：传输层安全（Transport Layer Security）

SSL协议是网景公司（Netscape）在 1994 年开发的安全协议。 1995年 Netscape 把SSL 交给 IETF，希望能把 SSL 标准化， IETF 就在 SSL 3.0 的基础上设计了 TLS协议，为所有基于 TCP 的网络应用提供安全数据传输服务。

SSL/TLS 位于应用层与传输层之间，应用最广泛的是HTTP（https，端口443）。

![SSL/TLS](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200229144505.png)

web安全传输的简要过程：

1. **协商加密算法**。浏览器 A 向服务器 B 发送浏览器的 SSL 版本号和一些可选的加密算法，B 从中选定自己所支持的算法，并告知 A。
2. **服务器鉴别**。服务器 B 向浏览器 A 发送一个包含其 RSA 公钥的数字证书，A 使用该证书的认证机构 CA 的公开发布的 RSA 公钥对该证书进行验证。
3. **会话密钥计算**。由浏览器 A 随机产生一个秘密数，用服务器 B 的 RSA 公钥进行加密后发送给 B。双方根据协商的算法产生一个共享的**对称会话密钥**。
4. **安全数据传输**。双方用会话密钥加密和解密它们之间传送的数据并验证其完整性。

![SSL传输过程](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200229144859.png)

### 网络层 IPsec

网络层的安全协议 IPsec 就是 “IP 安全（Security）协议”的缩写。

IPsec 协议簇中有两个主要的协议：**鉴别首部 AH（Authentication Header）协议**和**封装安全有效载荷 ESP（Encapsulation Security Payload）协议**。

AH 协议提供源点鉴别和数据完整性，但不能保密（相当于数字签名）。ESP 协议比 AH 协议复杂得多，提供源点鉴别、数据完整性和保密。

发送 IPSec 之前，在源实体（主机 or 路由器）和目的实体之间必须创建一条网络层的逻辑连接，即**安全关联 SA（Security Association）**。SA 是源点到终点的**单向连接**，若要双向安全通信，需要建立两个方向的 SA。

#### IPsec 数据报格式

![IPsec](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200229153726.png)

- ESP 首部，两个字段，32 + 32bit。

  - SPI：Security Parameter Index，安全参数索引。通过同一个 SA 的所有 IPsec 数据报都使用同样地 SPI值。
  - 序号：防止重放攻击，即使分组重传时序号也不重复。

- ESP MAC：报文鉴别码。

- ESP尾部：三个字段

  - 填充：全为0，用来凑整

  - 填充长度，8bit

  - 下一个首部：下一个首部指的是运输层报文段或IP数据报中的首部，能将有效载荷部分提交给TCP 。

    ![](https://gitee.com/qiutongxue/blog-images/raw/master/img/20200229160152.png)
